
# In this analysis, I want to answer these questions:
# - What's the total of entries of the emojis per range of age? [x]
# - What's the total of entries of the emojis per platform [x]
# - What's the total of entries of each emoji? [x]
# - What's the entries of each context? [x]
# - What's the feeling most used in young male guys? [x]


library('tidyverse')
library('janitor')

df <- read_csv('emoji_usage_dataset.csv')

# Exploring the data
glimpse(df)

# Cleaning the data
df <- clean_names(df)
df <- remove_empty(df, which='cols', cutoff=1, quiet = FALSE)

# Total entries of emojis per plataform
df %>% group_by(emoji, platform) %>% 
  summarise(total_entries=n()) %>% 
  arrange(desc(total_entries)) -> emoji_per_platform

# Total entries of each emoji
df %>% group_by(emoji) %>% 
  summarise(total_entries=n()) %>% 
  arrange(desc(total_entries)) -> emoji_total


min(df$user_age)
max(df$user_age)
# My age is from 13 to 64
df %>% mutate(category= case_when(
  user_age>12 & user_age<30 ~ 'young',
  user_age>29 & user_age<40 ~ 'middle-aged',
  user_age>39 ~ 'adult',
  .default='other' 
)) -> df_processed 


df_processed %>% group_by(emoji, category) %>% 
  summarize(total_entries=n()) -> emoji_per_category

df_processed %>% group_by(context) %>% 
  summarise(total_entries=n()) %>% 
  arrange(desc(total_entries)) -> feelings_total

df_processed %>% filter(category=='young' & user_gender=='Male') %>%
  group_by(context) %>% 
  summarise(total_entries=n()) %>% 
  arrange(desc(total_entries)) -> feelings_young_male

# once that we have the data that answer our questions let's plot
# I'll be do this process with tableau, so lets export the data

write.csv(emoji_total, file="./emoji_total.csv")
write.csv(emoji_per_category, file="./emoji_per_category.csv")
write.csv(emoji_per_plataform, file="./emoji_per_plataform.csv")
write.csv(feelings_young_male, file="./feelings_young_male.csv")
write.csv(feelings_total, file='./feelings_total.csv')

colnames(emoji_total)

# because I want to practice more, i'll do it with ggplot2 too



ggplot(emoji_total, aes(x = emoji , y = total_entries, fill=emoji, label='h')) +
  geom_bar(stat = "identity") + 
  geom_text(family = "EmojiOne", size = 6) +
  labs(title='Emoji Usage per Total Entrie')

# 'showtext' para usar fuentes externas
install.packages("showtext")
library(showtext)
?font_add
font_add("NotoEmoji","./NotoEmoji-Light.ttf")
showtext_auto()


# - What's the total of entries of each emoji? [x]
ggplot(emoji_total, aes(x = emoji, y = total_entries)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Uso de Emojis", x = "Emoji", y = "Entradas Totales") +
  theme_minimal() +
  theme(axis.text.x = element_text(family = "NotoEmoji", size = 12))

# - What's the total of entries of the emojis per range of age? [x]
ggplot(emoji_per_category, aes(x=emoji, y=total_entries)) +
  geom_bar(stat='identity', fill='skyblue') +
  facet_wrap(~category) +
  labs(title = 'Total usage emojis per range of age', x='emoji', y='total entries') +
  theme_minimal() +
  theme(axis.text.x = element_text(family = "NotoEmoji", size = 12))

# - What's the total of entries of the emojis per platform [x]
ggplot(emoji_per_platform, aes(x=emoji, y=total_entries, fill=platform)) +
  geom_bar(stat='identity') +
  facet_wrap(~platform) +
  labs(title='Emoji usage per platform', x='emoji', y='total entries') +
  theme_minimal() +
  theme(axis.text.x = element_text(family = "NotoEmoji", size = 12))

# - What's the entries of each context? [x]
ggplot(feelings_total, aes(x = context, y = total_entries, fill = context)) +
  geom_bar(stat = 'identity') +
  labs(title = 'Context of the emojis', x = 'Context', y = 'Total Entries') +
  theme_minimal() +
  theme(axis.text.x = element_text(family = "Noto Emoji", size = 12))

# * What's the context most used in young male guys? 
ggplot(feelings_young_male, aes(x = context, y = total_entries, fill = context)) +
  geom_bar(stat = 'identity') +
  labs(title = 'Context of the emojis young male guys', x = 'Context', y = 'Total Entries') +
  theme_minimal() +
  theme(axis.text.x = element_text(family = "Noto Emoji", size = 12))

colnames(emoji_per_category)
# answer questions about most used emojis per category
emoji_per_category %>% filter(category=='young') %>% 
  arrange(-total_entries) %>% 
  View()

# What's the most used emoji per plataform
emoji_per_platform %>%
  group_by(platform)
